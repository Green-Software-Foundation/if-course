# Synchronising Time Series with Time-Sync

In the previous module we worked with a single component that had neatly aligned timestamps. In practice, you'll often have **multiple components** — for example, two servers behind a load balancer — each with their own time series data that may start and end at different times.

## The Problem

Imagine our website is served by two servers. We gathered monitoring data, but it doesn't cover the same time window:

- **server-1** has data for hours 00:00 and 01:00
- **server-2** has data for hours 01:00 and 02:00

```
Time:       00:00     01:00     02:00
server-1:   ████████  ████████
server-2:             ████████  ████████
```

If we want to aggregate or compare these servers, we need their time series to be aligned. We can't meaningfully sum server-1's carbon at 00:00 with server-2's carbon at 01:00 — we need both to cover the same time window.

## The TimeSync Plugin

Impact Framework provides a built-in `TimeSync` plugin that synchronises all time series across components to a common time window. It pads missing periods so every component has observations for every timestep.

### Configuration

The `TimeSync` plugin is initialised like any other plugin, with config specifying the global time window:

```yaml
time-sync:
  method: TimeSync                              # <1>
  path: builtin
  config:
    start-time: '2023-08-01T00:00:00.000Z'     # <2>
    end-time: '2023-08-01T03:00:00.000Z'        # <2>
    interval: 3600                               # <3>
    allow-padding: true                          # <4>
```

- <1>: The `TimeSync` method from the builtin standard library.
- <2>: The global time window — all components will be aligned to cover this range. The `end-time` is exclusive, so this covers 00:00 to 02:00 (three 1-hour slots).
- <3>: The `interval` in seconds — here 3600 seconds (1 hour), matching our observation duration.
- <4>: `allow-padding: true` permits the plugin to fill in missing timesteps. If set to `false`, an error is thrown when padding would be needed.

### Pipeline Placement

Add `time-sync` as the **first step** in each component's pipeline, before any other plugins:

```yaml
pipeline:
  compute:
    - time-sync                          # <-- first!
    - memory-utilization-to-memory-energy
    - cloud-instance-metadata
    # ... rest of pipeline
```

This ensures all subsequent plugins receive consistently synchronised data.

## Worked Example

Let's extend our SCI walkthrough to two servers with mismatched time ranges. The only changes from the previous module are:

1. Add the `time-sync` plugin to `initialize`
2. Add `time-sync` as the first step in each component's pipeline
3. Create a second server component with a different time range

Here's the tree section of the manifest (the `initialize` block is the same as before, plus the `time-sync` plugin shown above):

```yaml
tree:
  children:
    # highlight-start
    server-1:
    # highlight-end
      defaults:
        cloud-region: westeurope
        cloud-instance: Standard_A2m_v2
        cloud-provider: "Microsoft Azure"
        ssd: 1
        hdd: 0
        gpu: 0
      pipeline:
        compute:
          # highlight-start
          - time-sync
          # highlight-end
          - memory-utilization-to-memory-energy
          - cloud-instance-metadata
          - cpu-utilization-to-tdp-multiplier
          - tdp-multiplier-to-cpu-power
          - cpu-power-to-cpu-energy
          - to-operational-energy
          - carbon-intensity-from-region
          - to-operational-carbon
          - embodied-carbon
          - to-total-carbon
          - sci
      inputs:
        # highlight-start
        - timestamp: '2023-08-01T00:00:00.000Z'
          duration: 3600
          memory-utilization: 8.8
          cpu-utilization: 80
          site-visits: 210
        - timestamp: '2023-08-01T01:00:00.000Z'
          duration: 3600
          memory-utilization: 5.2
          cpu-utilization: 55
          site-visits: 190
        # highlight-end
    # highlight-start
    server-2:
    # highlight-end
      defaults:
        cloud-region: westeurope
        cloud-instance: Standard_A2m_v2
        cloud-provider: "Microsoft Azure"
        ssd: 1
        hdd: 0
        gpu: 0
      pipeline:
        compute:
          # highlight-start
          - time-sync
          # highlight-end
          - memory-utilization-to-memory-energy
          - cloud-instance-metadata
          - cpu-utilization-to-tdp-multiplier
          - tdp-multiplier-to-cpu-power
          - cpu-power-to-cpu-energy
          - to-operational-energy
          - carbon-intensity-from-region
          - to-operational-carbon
          - embodied-carbon
          - to-total-carbon
          - sci
      inputs:
        # highlight-start
        - timestamp: '2023-08-01T01:00:00.000Z'
          duration: 3600
          memory-utilization: 15.4
          cpu-utilization: 90
          site-visits: 340
        - timestamp: '2023-08-01T02:00:00.000Z'
          duration: 3600
          memory-utilization: 12.1
          cpu-utilization: 75
          site-visits: 280
        # highlight-end
```

### Running It

```bash
if-run -m sci-walkthrough.yml
```

After time-sync, both servers now have **three** outputs covering the full 00:00–02:00 window:

**server-1** (originally had data for 00:00 and 01:00):

| Timestamp | cpu-utilization | carbon | sci |
|-----------|----------------|--------|-----|
| 00:00 | 80 | 86.73 | 0.41 |
| 01:00 | 55 | 78.50 | 0.41 |
| 02:00 | 55 *(padded)* | 78.50 | 0.41 |

**server-2** (originally had data for 01:00 and 02:00):

| Timestamp | cpu-utilization | carbon | sci |
|-----------|----------------|--------|-----|
| 00:00 | 90 *(padded)* | 90.60 | 0.27 |
| 01:00 | 90 | 90.60 | 0.27 |
| 02:00 | 75 | 85.53 | 0.31 |

Both servers now cover the same three timesteps, making them ready for aggregation and comparison.

> [!NOTE]
> When `time-sync` pads missing timesteps, it copies the values from the nearest available observation rather than using zeros. This is visible in the tables above — server-1's padded 02:00 entry has the same values as its 01:00 entry, and server-2's padded 00:00 entry matches its 01:00 entry.

For full configuration details, see the [Time documentation](https://if.greensoftware.foundation/major-concepts/time).
